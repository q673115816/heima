<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=   , initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <script src="https://cdn.bootcss.com/lodash.js/4.17.11/lodash.js"></script>
    <script>
        var bb = {}
        bb.memoize = function (func, hasher) {
            console.log(this);
            console.log(arguments);
            var memoize = function (key) {
                // 把存储对象的引用拿出来，便于后面代码使用
                var cache = memoize.cache;

                // hasher 是计算 key 值的方法函数。
                // 如果传入了 hasher，则用 hasher 函数来计算 key
                // 否则用 参数 key（即 memoize 方法传入的第一个参数）当 key
                console.log("(hasher ? hasher.apply(this, arguments) : key);");
                console.log(this);
                console.log(arguments);
                console.log(key);
                

                var address = '' + (hasher ? hasher.apply(this, arguments) : key);

                // 如果 key 还没有对应的 hash 值（意味着没有缓存值，没有计算过该输入）
                // 就执行回调函数，并缓存结果值
                if (!_.has(cache, address)) {
                    console.log("!_.has(cache, address)");
                    console.log(this);
                    console.log(arguments);
                    console.log(key);
                    cache[address] = func.apply(this, arguments);
                }

                // 从缓存对象中取结果值
                return cache[address];
            };

            // cache 对象被当做 key-value 键值对缓存中间运算结果
            memoize.cache = {};

            // 返回 momoize 函数, 由于返回函数内部引用了 memoize.cache, 构成了闭包，变量保存在了内存中。
            return memoize;
        };

        function isPrime(value) {
            console.log("isPrime 被执行了！");
            var prime = value != 1; // 1 不是素数，其他数字默认是素数。
            for (var i = 2; i < value; i++) {
                if (value % i == 0) {
                    prime = false;
                    break;
                }
            }
            return prime
        }

        let momoizedIsPrime = bb.memoize(isPrime);

        momoizedIsPrime(5) // isPrime 被执行了！
        momoizedIsPrime(5) // 第二次执行，没有打印日志！
    </script>
</body>

</html>